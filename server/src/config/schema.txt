CREATE TABLE public.cart (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  user_id uuid DEFAULT gen_random_uuid(),
  session_id uuid DEFAULT auth.uid(),
  updated_at timestamp without time zone,
  CONSTRAINT cart_pkey PRIMARY KEY (id),
  CONSTRAINT cart_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.cart_item (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  cart_id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid DEFAULT gen_random_uuid(),
  product_id bigint,
  quantity numeric,
  CONSTRAINT cart_item_pkey PRIMARY KEY (id),
  CONSTRAINT cart_item_cart_id_fkey FOREIGN KEY (cart_id) REFERENCES public.cart(id),
  CONSTRAINT cart_item_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.order(id),
  CONSTRAINT cart_item_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.product(id),
  CONSTRAINT cart_item_cart_id_fkey1 FOREIGN KEY (cart_id) REFERENCES public.cart(id),
  CONSTRAINT cart_item_order_id_fkey1 FOREIGN KEY (order_id) REFERENCES public.order(id),
  CONSTRAINT cart_item_product_id_fkey1 FOREIGN KEY (product_id) REFERENCES public.product(id)
);
CREATE TABLE public.category (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  name text NOT NULL,
  slug text NOT NULL UNIQUE,
  description character varying,
  CONSTRAINT category_pkey PRIMARY KEY (id)
);
CREATE TABLE public.order (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  total_kobo numeric,
  currency text DEFAULT 'NGN'::text,
  status text,
  shipping_address character varying DEFAULT ''::character varying,
  payment_method text NOT NULL DEFAULT ''::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone,
  CONSTRAINT order_pkey PRIMARY KEY (id),
  CONSTRAINT order_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.order_item (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id bigint,
  quantity numeric,
  unit_price_kobo numeric NOT NULL,
  CONSTRAINT order_item_pkey PRIMARY KEY (id),
  CONSTRAINT order_item_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.order(id),
  CONSTRAINT order_item_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.product(id)
);
CREATE TABLE public.product (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  title character varying,
  description character varying,
  price_kobo numeric,
  currency text DEFAULT 'NGN'::text,
  sku character varying,
  inventory_count numeric,
  category_id integer,
  is_active boolean,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp with time zone NOT NULL,
  images ARRAY,
  CONSTRAINT product_pkey PRIMARY KEY (id),
  CONSTRAINT product_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.category(id)
);
CREATE TABLE public.refresh_tokens (
  user_id uuid NOT NULL,
  expires_at timestamp with time zone NOT NULL,
  token_hash character varying NOT NULL,
  CONSTRAINT refresh_tokens_pkey PRIMARY KEY (user_id),
  CONSTRAINT refresh_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text,
  email character varying,
  role text DEFAULT 'user'::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone,
  password character varying NOT NULL,
  CONSTRAINT users_pkey PRIMARY KEY (id)
);